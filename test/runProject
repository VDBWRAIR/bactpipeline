#!/usr/bin/env python
# mock runProject roche

from __future__ import print_function

import sys
import fileinput

lenargs = len(sys.argv)

primer_file = None
if lenargs == 4:
    vtarg = sys.argv[1] # should just be -vt
    primer_file = sys.argv[2]
    projdir = sys.argv[3]
else:
    projdir = sys.argv[1]

# Make mock 454AllContigs.fna
allcontig = "{0}/assembly/454AllContigs.fna".format(projdir)
with open(allcontig, 'w') as fw:
    fw.write(">contig00001  length=10   numreads=1170\n")
    fw.write("AATTGGCCAA\n")

if primer_file:
    # Add VectorDatabase with primer file specified to xml
    assemblyxml = "{0}/assembly/454AssemblyProject.xml".format(projdir)
    for line in fileinput.input(assemblyxml, inplace=1):
        if 'VectorDatabase' in line:
            sys.stdout.write('<VectorDatabase>{0}</VectorDatabase>\n'.format(primer_file))
        else:
            sys.stdout.write(line)
        sys.stdout.flush()

print('''Assembly computation starting at: Wed Dec 16 15:20:43 2015  (v2.9 (20130529_1641))
Indexing sample1_S1_L001_R1_001.fastq (with quality scores)...
  -> 1000 reads, 228722 bases.
Indexing sample1_S1_L001_R2_001.fastq (with quality scores)...
  -> 1000 reads, 228595 bases.
Setting up long overlap detection...
  -> 1954 of 1954, 1709 reads to align
Building a tree for 15436 seeds...
Computing long overlap alignments...
  -> 1954 of 1954
Setting up overlap detection...
  -> 1954 of 1954, 591 reads to align
Starting seed building...
  -> 1954 of 1954
Building a tree for 8687 seeds...
Computing alignments...
  -> 1954 of 1954
Checkpointing...
Detangling alignments...
   -> Level 4, Phase 9, Round 1...
Checkpointing...
Building contigs/scaffolds...
   -> 1 large contigs, 1 all contigs
Computing signals...
  -> 10740 of 10740...
Checkpointing...
Generating output...
  -> 10740 of 10740...
Assembly computation succeeded at: Wed Dec 16 15:21:45 2015''')
